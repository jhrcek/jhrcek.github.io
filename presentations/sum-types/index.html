<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Jan Hrček">
  <meta name="dcterms.date" content="2018-11-29">
  <title>Help the compiler help you</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="reveal.js/css/reveal.css">
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="reveal.js/css/theme/beige.css" id="theme">
  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement( 'link' );
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match( /print-pdf/gi ) ? 'reveal.js/css/print/pdf.css' : 'reveal.js/css/print/paper.css';
    document.getElementsByTagName( 'head' )[0].appendChild( link );
  </script>
  <!--[if lt IE 9]>
  <script src="reveal.js/lib/js/html5shiv.js"></script>
  <![endif]-->
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section id="title-slide">
  <h1 class="title">Help the compiler help you</h1>
  <p class="author">Jan Hrček</p>
  <p class="date">November 29, 2018</p>
</section>

<section id="motivation" class="slide level1">
<h1>Motivation</h1>
<ul>
<li>Taking advantage of the compiler
<ul>
<li>modelling data</li>
</ul></li>
<li>Motivation to learn more about FP</li>
</ul>
</section>
<section id="software-quality" class="slide level1">
<h1>Software quality</h1>
<blockquote>
<p>It is almost always better to catch your mistakes earlier than later</p>
</blockquote>
</section>
<section id="feedback-loop" class="slide level1">
<h1>Feedback loop</h1>
<ul>
<li>How long does it take to discover a mistake?</li>
<li>The shorter, the better!</li>
</ul>
</section>
<section class="slide level1">

<p><img data-src="image/rising-cost-of-defects.png" /></p>
<p><a href="https://www.seguetech.com/rising-costs-defects/">source</a></p>
</section>
<section class="slide level1">

<h2 id="mistakes-in-production-cost-you">Mistakes in production cost you</h2>
<ul>
<li>Reputation</li>
<li>People</li>
<li>Money</li>
<li>Morale</li>
<li>Mental effort</li>
</ul>
</section>
<section id="testing" class="slide level1">
<h1>Testing</h1>
<ul>
<li>A technique to ensure that our programs have desirable properties</li>
</ul>
</section>
<section class="slide level1">

<h2 id="testing-problems-1">Testing: problems (1)</h2>
<ul>
<li>The code must be implemented with testability in mind
<ul>
<li>Requires a lot of skill and discipline</li>
<li>Mocking - workaround to enable testing hard-to-test code</li>
</ul></li>
</ul>
</section>
<section class="slide level1">

<h2 id="testing-problems-2">Testing: problems (2)</h2>
<ul>
<li>Need to develop, maintain the tests, automation and hardware infra to run them</li>
</ul>
</section>
<section class="slide level1">

<h2 id="testing-problems-3">Testing: problems (3)</h2>
<ul>
<li>Large test suites take time to run</li>
<li>Example: kiegroup projects
<ul>
<li>3 hours for to run all tests in upstream (daily build)</li>
<li>up to couple of days to run and analyze results of all QE tests</li>
</ul></li>
</ul>
</section>
<section class="slide level1">

<h2 id="testing-problems-4">Testing: problems (4)</h2>
<ul>
<li>Mainstream languages don’t force you to write more testable code
<ul>
<li>side effects not tracked in types</li>
<li>mutability by default</li>
<li>sloppy error handling
<ul>
<li>no support for sum types</li>
<li><a href="https://twitter.com/mariofusco/status/739698058582196224">exceptions</a></li>
</ul></li>
</ul></li>
</ul>
</section>
<section class="slide level1">

<h2 id="testing-problems-5">Testing: problems (5)</h2>
<ul>
<li>test coverage</li>
<li>mutation coverage</li>
</ul>
</section>
<section class="slide level1">

<h3 id="exercise-1">Exercise 1</h3>
<p>We have a Settings class with 10 boolean fields.<br/> How many states can object of this class potentially be in?</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb1-1" title="1"><span class="dt">final</span> <span class="kw">class</span> Settings {</a>
<a class="sourceLine" id="cb1-2" title="2">    <span class="kw">private</span> <span class="dt">boolean</span> one;</a>
<a class="sourceLine" id="cb1-3" title="3">    <span class="kw">private</span> <span class="dt">boolean</span> two;</a>
<a class="sourceLine" id="cb1-4" title="4">    ...</a>
<a class="sourceLine" id="cb1-5" title="5">    <span class="kw">private</span> <span class="dt">boolean</span> ten;</a>
<a class="sourceLine" id="cb1-6" title="6">    ...</a>
<a class="sourceLine" id="cb1-7" title="7">}</a></code></pre></div>
</section>
<section class="slide level1">

<h3 id="exercise-1---solution">Exercise 1 - solution</h3>
<p>2^10 = 1024</p>
</section>
<section class="slide level1">

<h3 id="exercise-2">Exercise 2</h3>
<p>Say we replace boolean with Boolean in exercise 2.<br/> How does that change the answer?</p>
</section>
<section class="slide level1">

<h3 id="exercise-2---solution">Exercise 2 - solution</h3>
<p>3^10 = 59049</p>
<p>Lessons:</p>
<ul>
<li>adding even just one value to your type can lead to combinatorial explosion of possibilities (are you testing them all?)</li>
<li>it would be nice to make the amount of values in our types smaller</li>
</ul>
</section>
<section id="static-code-analysis" class="slide level1">
<h1>Static code analysis</h1>
<ul>
<li>Find issues BEFORE the tests are run</li>
<li>FindBugs, Sonar, Checkstyle, linters, …</li>
</ul>
</section>
<section class="slide level1">

<h2 id="static-code-analysis-problems-1">Static code analysis: problems (1)</h2>
<ul>
<li>Limited usefulness
<ul>
<li>the tools often don’t know enough about our code to give reliable results
<ul>
<li>Many issues not detected</li>
<li>Tons of false positives</li>
</ul></li>
</ul></li>
</ul>
</section>
<section class="slide level1">

<h2 id="example">Example</h2>
<p>Dominik made a <a href="https://github.com/kiegroup/appformer/pull/534">PR</a> to appformer where he fixed “Probable Bugs” related to unclosed streams/files</p>
</section>
<section class="slide level1">

<h2 id="example-1">Example</h2>
<p><img data-src="image/EdersComment.png" /></p>
</section>
<section class="slide level1">

<h2 id="static-code-analysis-problems-2">Static code analysis: problems (2)</h2>
<ul>
<li>takes time to run
<ul>
<li>findbugs-maven-plugin takes ~30 minutes to run in KIE daily build</li>
</ul></li>
</ul>
</section>
<section class="slide level1">

<h2 id="static-code-analysis-problems-3">Static code analysis: problems (3)</h2>
<ul>
<li>Requires work too
<ul>
<li>someone needs to run the tools, report / fix the issues found</li>
<li>OR setup and maintain the automation and hardware infra</li>
</ul></li>
</ul>
</section>
<section id="is-there-nothing-better" class="slide level1">
<h1>Is there nothing better?</h1>
</section>
<section id="central-idea" class="slide level1">
<h1>Central Idea</h1>
<h2 id="let-the-compiler-find-the-bugs">Let the compiler find the bugs!</h2>
</section>
<section id="misconception" class="slide level1">
<h1>Misconception</h1>
<ul>
<li><p>Statically vs. dynamically typed languages</p></li>
<li>Dynamic: JavaScript, Python, PHP, Ruby, …</li>
<li><p>Static: Java, C++, C#, TypeScript, …</p></li>
</ul>
</section>
<section class="slide level1">

<p><img data-src="image/TypeSystemsVaryALot.png" /> <a href="#/fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
</section>
<section class="slide level1">

<h2 id="encode-desirable-properties-of-your-program-into-types">Encode desirable properties of your program into types</h2>
</section>
<section class="slide level1">

<h2 id="code-that-doesnt-have-those-properties-doesnt-compile">Code that doesn’t have those properties, doesn’t compile!</h2>
</section>
<section class="slide level1">

<h2 id="unlike-testsstatic-analysis-compilation-failures-cant-be-ignored">Unlike tests/static analysis, compilation failures can’t be ignored</h2>
</section>
<section class="slide level1">

<h2 id="relying-on-compiler-scales-better">Relying on compiler scales better</h2>
<ul>
<li>What do we need if we want to handle mistakes found during
<ul>
<li>production?</li>
<li>testing / static analysis?</li>
<li>compilation?</li>
</ul></li>
</ul>
</section>
<section class="slide level1">

<h2 id="different-way-to-look-at-testing">Different way to look at testing</h2>
<blockquote>
<p>“You must only write tests for properties, that can’t be expressed in types”</p>
</blockquote>
</section>
<section class="slide level1">

<h2 id="different-way-to-look-at-testing-2">Different way to look at testing (2)</h2>
<p>Thanks to powerful type system you can GENERATE random test cases for you code without writing tons of boilerplate</p>
</section>
<section class="slide level1">

<h2 id="encode-information-into-types">Encode information into types</h2>
<h3 id="how">How?</h3>
</section>
<section class="slide level1">

<h2 id="model-the-problem-domain-precisely-using-data-types">Model the problem domain precisely using data types</h2>
</section>
<section class="slide level1">

<h2 id="precise-model">Precise model</h2>
<ul>
<li>states of the program correspond to valid states of the modeled domain</li>
<li>things that are invalid in the modeled domain can’t be represented in the program</li>
</ul>
</section>
<section id="modeling-data-in-fp" class="slide level1">
<h1>Modeling data in FP</h1>
<h2 id="algebraic-data-types">Algebraic data types</h2>
</section>
<section class="slide level1">

<h2 id="algebraic-data-types-1">Algebraic data types (1)</h2>
<ul>
<li>Primitive types
<ul>
<li>Bool</li>
<li>Int</li>
<li>Char</li>
<li>String</li>
<li>…</li>
</ul></li>
</ul>
</section>
<section class="slide level1">

<h2 id="algebraic-data-types-2">Algebraic data types (2)</h2>
<ul>
<li>Complex types: built by combining existing types using one of two “operations”
<ul>
<li>Product</li>
<li>Sum (Coproduct)</li>
</ul></li>
</ul>
</section>
<section class="slide level1">

<h2 id="analogy-with-algebra">Analogy with algebra</h2>
<ul>
<li>Primitive types are like numbers
<ul>
<li>0 ~ Void (/= Java’s void!)</li>
<li>1 ~ ()</li>
<li>2 ~ Bool</li>
</ul></li>
</ul>
</section>
<section class="slide level1">

<h2 id="analogy-with-algebra-2">Analogy with algebra (2)</h2>
<ul>
<li>18446744073709551615 ~ Int</li>
<li>∞ ~ String</li>
<li>x, y, … ~ a, b
<ul>
<li>type variables</li>
<li>like T in Optional&lt;T&gt;</li>
</ul></li>
</ul>
</section>
<section class="slide level1">

<h2 id="analogy-with-algebra-3">Analogy with algebra (3)</h2>
<ul>
<li>Operations on types ~ operations on numbers
<ul>
<li>Product ~ x (multiplication)</li>
<li>Sum ~ + (addition)</li>
</ul></li>
</ul>
</section>
<section class="slide level1">

<h2 id="product">Product</h2>
<ul>
<li>Combine things together</li>
</ul>
</section>
<section class="slide level1">

<h2 id="product-1">Product</h2>
<ul>
<li>Product types correspond to <a href="https://en.wikipedia.org/wiki/Cartesian_product">Cartesian product</a> from set theory<br/> <code>A ⨯ B = {(a,b) | a ∈ A, b ∈ B}</code></li>
</ul>
</section>
<section class="slide level1">

<h3 id="exercise-3">Exercise 3</h3>
<p><img data-src="image/ProductEx1_Question.png" /></p>
</section>
<section class="slide level1">

<h3 id="exercise-3---solution">Exercise 3 - solution</h3>
<p><img data-src="image/ProductEx1_Solution.png" /></p>
</section>
<section class="slide level1">

<h3 id="do-we-have-product-types-in-java">Do we have Product types in Java?</h3>
</section>
<section class="slide level1">

<h2 id="product-example">Product example</h2>
<ul>
<li>domain-specific example (Java)</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">public</span> <span class="kw">class</span> User {</a>
<a class="sourceLine" id="cb2-2" title="2"></a>
<a class="sourceLine" id="cb2-3" title="3">    <span class="kw">private</span> <span class="dt">final</span> <span class="bu">String</span> name;</a>
<a class="sourceLine" id="cb2-4" title="4">    <span class="kw">private</span> <span class="dt">final</span> LocalDate dateOfBirth;</a>
<a class="sourceLine" id="cb2-5" title="5">    <span class="kw">private</span> <span class="dt">final</span> <span class="dt">boolean</span> isPremiumAccount;</a>
<a class="sourceLine" id="cb2-6" title="6"></a>
<a class="sourceLine" id="cb2-7" title="7">    <span class="kw">public</span> <span class="fu">User</span>(<span class="dt">final</span> <span class="bu">String</span> name,</a>
<a class="sourceLine" id="cb2-8" title="8">                <span class="dt">final</span> LocalDate dateOfBirth,</a>
<a class="sourceLine" id="cb2-9" title="9">                <span class="dt">final</span> <span class="dt">boolean</span> isPremiumAccount</a>
<a class="sourceLine" id="cb2-10" title="10">    ) {</a>
<a class="sourceLine" id="cb2-11" title="11">        <span class="kw">this</span>.<span class="fu">name</span> = name;</a>
<a class="sourceLine" id="cb2-12" title="12">        <span class="kw">this</span>.<span class="fu">dateOfBirth</span> = dateOfBirth;</a>
<a class="sourceLine" id="cb2-13" title="13">        <span class="kw">this</span>.<span class="fu">isPremiumAccount</span> = isPremiumAccount;</a>
<a class="sourceLine" id="cb2-14" title="14">    }</a>
<a class="sourceLine" id="cb2-15" title="15"></a>
<a class="sourceLine" id="cb2-16" title="16">    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">getName</span>() {</a>
<a class="sourceLine" id="cb2-17" title="17">        <span class="kw">return</span> name;</a>
<a class="sourceLine" id="cb2-18" title="18">    }</a>
<a class="sourceLine" id="cb2-19" title="19"></a>
<a class="sourceLine" id="cb2-20" title="20">    <span class="kw">public</span> LocalDate <span class="fu">getDateOfBirth</span>() {</a>
<a class="sourceLine" id="cb2-21" title="21">        <span class="kw">return</span> dateOfBirth;</a>
<a class="sourceLine" id="cb2-22" title="22">    }</a>
<a class="sourceLine" id="cb2-23" title="23"></a>
<a class="sourceLine" id="cb2-24" title="24">    <span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">isPremiumAccount</span>() {</a>
<a class="sourceLine" id="cb2-25" title="25">        <span class="kw">return</span> isPremiumAccount;</a>
<a class="sourceLine" id="cb2-26" title="26">    }</a>
<a class="sourceLine" id="cb2-27" title="27">}</a></code></pre></div>
</section>
<section class="slide level1">

<h2 id="product-example-1">Product example</h2>
<ul>
<li>domain-specific example (Haskell)</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">data</span> <span class="dt">User</span> <span class="fu">=</span> <span class="dt">User</span></a>
<a class="sourceLine" id="cb3-2" title="2">    {<span class="ot"> name ::</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb3-3" title="3">    ,<span class="ot"> dateOfBirth ::</span> <span class="dt">Day</span></a>
<a class="sourceLine" id="cb3-4" title="4">    ,<span class="ot"> isPremiumAccount ::</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb3-5" title="5">    }</a></code></pre></div>
</section>
<section class="slide level1">

<h3 id="what-is-the-most-generic-example-of-a-product-type">What is the most generic example of a product type?</h3>
</section>
<section class="slide level1">

<h2 id="pair-canonical-product">Pair: canonical product</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">public</span> <span class="kw">class</span> Pair&lt;A, B&gt; {</a>
<a class="sourceLine" id="cb4-2" title="2"></a>
<a class="sourceLine" id="cb4-3" title="3">    <span class="kw">private</span> <span class="dt">final</span> A a;</a>
<a class="sourceLine" id="cb4-4" title="4">    <span class="kw">private</span> <span class="dt">final</span> B b;</a>
<a class="sourceLine" id="cb4-5" title="5"></a>
<a class="sourceLine" id="cb4-6" title="6">    <span class="kw">public</span> <span class="fu">Pair</span>(A a, B b) {</a>
<a class="sourceLine" id="cb4-7" title="7">        <span class="kw">this</span>.<span class="fu">a</span> = a;</a>
<a class="sourceLine" id="cb4-8" title="8">        <span class="kw">this</span>.<span class="fu">b</span> = b;</a>
<a class="sourceLine" id="cb4-9" title="9">    }</a>
<a class="sourceLine" id="cb4-10" title="10"></a>
<a class="sourceLine" id="cb4-11" title="11">    <span class="kw">public</span> A <span class="fu">fst</span>() {</a>
<a class="sourceLine" id="cb4-12" title="12">        <span class="kw">return</span> a;</a>
<a class="sourceLine" id="cb4-13" title="13">    }</a>
<a class="sourceLine" id="cb4-14" title="14"></a>
<a class="sourceLine" id="cb4-15" title="15">    <span class="kw">public</span> B <span class="fu">snd</span>() {</a>
<a class="sourceLine" id="cb4-16" title="16">        <span class="kw">return</span> b;</a>
<a class="sourceLine" id="cb4-17" title="17">    }</a>
<a class="sourceLine" id="cb4-18" title="18">}</a></code></pre></div>
</section>
<section class="slide level1">

<h2 id="pair-canonical-product-1">Pair: canonical product</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">data</span> (a,b) <span class="fu">=</span> (a,b)</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="co">--           a * b</span></a>
<a class="sourceLine" id="cb5-3" title="3"></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="fu">fst</span> (a,b) <span class="fu">=</span> a</a>
<a class="sourceLine" id="cb5-5" title="5"></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="fu">snd</span> (a,b) <span class="fu">=</span> b</a></code></pre></div>
<ul>
<li>note on Haskell syntax
<ul>
<li>types starting with lowercase letters = type variables, e.g. <code>(a,b)</code></li>
<li>types starting with uppercase letters = concrete types, e.g. <code>(Int, Bool)</code></li>
</ul></li>
</ul>
</section>
<section class="slide level1">

<h2 id="pair-canonical-product-2">Pair: canonical product</h2>
<ul>
<li>any product type can be expressed using pair(s)</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb6-1" title="1">User ~ Pair&lt;<span class="bu">String</span>, Pair&lt;LocalDate, <span class="bu">Boolean</span>&gt;&gt;</a>
<a class="sourceLine" id="cb6-2" title="2">Triple&lt;A,B,C&gt; ~ Pair&lt;A,Pair&lt;B,C&gt;&gt; ~ Pair&lt;Pair&lt;A,B&gt;,C&gt;</a></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb7-1" title="1"><span class="dt">User</span> <span class="fu">~</span> (<span class="dt">String</span>, (<span class="dt">Day</span>, <span class="dt">Bool</span>))</a>
<a class="sourceLine" id="cb7-2" title="2">(a,b,c) <span class="fu">~</span> (a,(b,c)) <span class="fu">~</span> ((a,b),c)</a></code></pre></div>
</section>
<section class="slide level1">

<h3 id="working-with-product-getters">Working with product: getters</h3>
<ul>
<li>using products we build “bigger” values out of “smaller” values</li>
<li>using getters we’re extracting “smaller” values out of “bigger” product value</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb8-1" title="1">Pair&lt;<span class="bu">Integer</span>, <span class="bu">Boolean</span>&gt; p = <span class="kw">new</span> Pair&lt;&gt;(<span class="dv">1</span>, <span class="kw">true</span>);</a>
<a class="sourceLine" id="cb8-2" title="2"></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="bu">Integer</span> one = p.<span class="fu">fst</span>(); <span class="co">// 1</span></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="bu">Boolean</span> b = p.<span class="fu">snd</span>();   <span class="co">// true</span></a></code></pre></div>
</section>
<section class="slide level1">

<h2 id="product-summary">Product: summary</h2>
<ul>
<li>is like <strong>AND</strong> of types</li>
<li><code>User = String ⨯ LocalDate ⨯ boolean</code>
<ul>
<li>each value of type User has name <strong>AND</strong> dateOfBirth <strong>AND</strong> isPremiumAccount flag</li>
</ul></li>
<li><code>Pair&lt;A,B&gt; = A ⨯ B</code>
<ul>
<li>each value of type <code>Pair&lt;A,B&gt;</code> has a field of type A <strong>AND</strong> a field of type B</li>
</ul></li>
</ul>
</section>
<section id="sum" class="slide level1">
<h1>Sum</h1>
<ul>
<li>Choose between things</li>
<li>Product types are supported in most languages</li>
<li>Sum types not so widespread</li>
</ul>
</section>
<section class="slide level1">

<h2 id="sum-types">Sum types</h2>
<ul>
<li>different languages call them differently
<ul>
<li>union types</li>
<li>tagged unions</li>
<li>variant types</li>
<li>choice types</li>
</ul></li>
</ul>
</section>
<section class="slide level1">

<h2 id="sum-1">Sum</h2>
<ul>
<li>Sum types correspond to <a href="https://en.wikipedia.org/wiki/Disjoint_union">disjoint union</a> in set theory<br/> <img src="image/disjoint_union.svg" style="height:100px;"/></li>
</ul>
</section>
<section class="slide level1">

<h2 id="disjoint-union-vs-union">Disjoint union vs Union</h2>
<p><img data-src="image/DisjointUnionVsUnion0.png" /></p>
</section>
<section class="slide level1">

<h2 id="disjoint-union-vs-union-1">Disjoint union vs Union</h2>
<p><img data-src="image/DisjointUnionVsUnion1.png" /></p>
</section>
<section class="slide level1">

<h2 id="disjoint-union-vs-union-2">Disjoint union vs Union</h2>
<p><img data-src="image/DisjointUnionVsUnion2.png" /></p>
</section>
<section class="slide level1">

<h2 id="why-sum">Why sum?</h2>
<p><img data-src="image/DisjointUnionVsUnionCounting0.png" /></p>
</section>
<section class="slide level1">

<h2 id="why-sum-1">Why sum?</h2>
<p><img data-src="image/DisjointUnionVsUnionCounting1.png" /></p>
</section>
<section class="slide level1">

<h2 id="why-sum-2">Why sum?</h2>
<p><img data-src="image/DisjointUnionVsUnionCounting2.png" /></p>
</section>
<section class="slide level1">

<h3 id="exercise-4">Exercise 4</h3>
<p><img data-src="image/SumEx1_Question.png" /></p>
</section>
<section class="slide level1">

<h2 id="exercise-4---solution">Exercise 4 - solution</h2>
<p><img data-src="image/SumEx1_Solution.png" /></p>
</section>
<section class="slide level1">

<h2 id="sum-2">Sum</h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">data</span> <span class="dt">Bool</span> <span class="fu">=</span> <span class="dt">True</span> <span class="fu">|</span> <span class="dt">False</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="co">--    2   =   1  +  1</span></a></code></pre></div>
<ul>
<li>each value of type Bool is either True OR False</li>
</ul>
</section>
<section class="slide level1">

<h2 id="sum-3">Sum</h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">data</span> <span class="dt">ParseResult</span> <span class="fu">=</span> <span class="dt">Success</span> <span class="dt">Int</span> <span class="fu">|</span> <span class="dt">Error</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="co">--                         Int +       String    </span></a></code></pre></div>
<ul>
<li>each value of type ParseResult is either Int (wrapped in Success constructor) OR String (wrapped in Error constructor)</li>
</ul>
</section>
<section class="slide level1">

<h3 id="what-is-the-most-generic-example-of-a-sum-type">What is the most generic example of a sum type?</h3>
</section>
<section class="slide level1">

<h2 id="either-canonical-product">Either: canonical product</h2>
<ul>
<li>analogy to pair</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">data</span> <span class="dt">Either</span> a b <span class="fu">=</span> <span class="dt">Left</span> a <span class="fu">|</span> <span class="dt">Right</span> b</a>
<a class="sourceLine" id="cb11-2" title="2"><span class="co">--                  a    +    b  </span></a></code></pre></div>
</section>
<section class="slide level1">

<h2 id="example-either-bool-int">Example: Either Bool Int</h2>
<p><img data-src="image/EitherExample.png" /></p>
</section>
<section class="slide level1">

<h2 id="sums-pattern-matching">Sums: pattern matching</h2>
<ul>
<li>analogy to getters</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb12-1" title="1"><span class="fu">not</span><span class="ot"> ::</span> <span class="dt">Bool</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb12-2" title="2"><span class="fu">not</span> <span class="dt">True</span> <span class="fu">=</span> <span class="dt">False</span></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="fu">not</span> <span class="dt">False</span> <span class="fu">=</span> <span class="dt">True</span></a></code></pre></div>
</section>
<section class="slide level1">

<h2 id="sums-pattern-matching-2">Sums: pattern matching (2)</h2>
<div class="sourceCode" id="cb13"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb13-1" title="1"><span class="ot">showParseResult ::</span> <span class="dt">ParseResult</span> <span class="ot">-&gt;</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb13-2" title="2">showParseResult (<span class="dt">Success</span> x) <span class="fu">=</span> <span class="st">&quot;I successfully parsed &quot;</span> <span class="fu">++</span> <span class="fu">show</span> x</a>
<a class="sourceLine" id="cb13-3" title="3">showParseResult (<span class="dt">Error</span> e) <span class="fu">=</span> <span class="st">&quot;There was a parsing error: &quot;</span> <span class="fu">++</span> e</a></code></pre></div>
</section>
<section class="slide level1">

<h2 id="sum-types-summary">Sum types: summary</h2>
<ul>
<li>is like “OR” of types</li>
<li>each value of type <code>Bool</code> is either True OR False</li>
<li>each value of type <code>Either A B</code> is either a value of type A OR of type B</li>
</ul>
</section>
<section class="slide level1">

<h2 id="algebraic-properties">Algebraic properties!</h2>
<ul>
<li>commutativity: a + b = b + a</li>
<li>associativity: (a * b) * c = a * (b * c)</li>
<li>distributivity: a * (b + c) = a * b + a * c</li>
<li>0 is unit for addition: a + 0 = a</li>
<li>1 is unit for multiplication : a * 1 = a</li>
<li>0 cancels multiplication: 0 * a = 0</li>
</ul>
</section>
<section class="slide level1">

<h2 id="recap">Recap</h2>
<ul>
<li>we have
<ol type="1">
<li>primitive types (Int, Bool, String, …)</li>
<li>two ways to build more complex types out of other types (sums and products)</li>
<li>algebraic properties (enable refactoring!)</li>
</ol></li>
</ul>
</section>
<section class="slide level1">

<h2 id="combine-products-and-sums">Combine Products and Sums</h2>
<p>… to model the domain precisely</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">data</span> <span class="dt">PaymentResponse</span></a>
<a class="sourceLine" id="cb14-2" title="2">  <span class="fu">=</span> <span class="dt">Paid</span> {<span class="ot"> receiptId ::</span> <span class="dt">String</span>,<span class="ot"> amount ::</span> <span class="dt">Money</span> }</a>
<a class="sourceLine" id="cb14-3" title="3">  <span class="fu">|</span> <span class="dt">CardExpired</span> {<span class="ot"> expiryDate ::</span> <span class="dt">Date</span>,<span class="ot"> lastFourDigits ::</span> <span class="dt">String</span> }</a>
<a class="sourceLine" id="cb14-4" title="4">  <span class="fu">|</span> <span class="dt">HttpError</span> {<span class="ot"> statusCode ::</span> <span class="dt">Int</span>,<span class="ot"> message ::</span> <span class="dt">String</span> }</a>
<a class="sourceLine" id="cb14-5" title="5">  <span class="fu">|</span> <span class="dt">AuthError</span></a></code></pre></div>
</section>
<section class="slide level1">

<h2 id="sum-types-in-java">Sum types in java?</h2>
<ul>
<li>enums?</li>
</ul>
</section>
<section class="slide level1">

<h2 id="sum-types-in-java-1">Sum types in java?</h2>
<ul>
<li>enums?</li>
<li>inheritance?</li>
</ul>
</section>
<section class="slide level1">

<h2 id="sum-example">Sum example</h2>
<ul>
<li>generic example (Java)</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb15-1" title="1"><span class="kw">public</span> <span class="kw">abstract</span> <span class="kw">class</span> Either&lt;L, R&gt; {</a>
<a class="sourceLine" id="cb15-2" title="2"></a>
<a class="sourceLine" id="cb15-3" title="3">    <span class="kw">public</span> <span class="dt">static</span> &lt;L, R&gt; Either&lt;L, R&gt; <span class="fu">left</span>(L value) {</a>
<a class="sourceLine" id="cb15-4" title="4">        <span class="kw">return</span> <span class="kw">new</span> Either&lt;L, R&gt;() {</a>
<a class="sourceLine" id="cb15-5" title="5">            <span class="at">@Override</span></a>
<a class="sourceLine" id="cb15-6" title="6">            <span class="kw">public</span> &lt;T&gt; T <span class="fu">map</span>(Function&lt;? <span class="kw">super</span> L, ? <span class="kw">extends</span> T&gt; lFunc,</a>
<a class="sourceLine" id="cb15-7" title="7">                             Function&lt;? <span class="kw">super</span> R, ? <span class="kw">extends</span> T&gt; rFunc) {</a>
<a class="sourceLine" id="cb15-8" title="8">                <span class="kw">return</span> lFunc.<span class="fu">apply</span>(value);</a>
<a class="sourceLine" id="cb15-9" title="9">            }</a>
<a class="sourceLine" id="cb15-10" title="10">        };</a>
<a class="sourceLine" id="cb15-11" title="11">    }</a>
<a class="sourceLine" id="cb15-12" title="12"></a>
<a class="sourceLine" id="cb15-13" title="13">    <span class="kw">public</span> <span class="dt">static</span> &lt;L, R&gt; Either&lt;L, R&gt; <span class="fu">right</span>(R value) {</a>
<a class="sourceLine" id="cb15-14" title="14">        <span class="kw">return</span> <span class="kw">new</span> Either&lt;L, R&gt;() {</a>
<a class="sourceLine" id="cb15-15" title="15">            <span class="at">@Override</span></a>
<a class="sourceLine" id="cb15-16" title="16">            <span class="kw">public</span> &lt;T&gt; T <span class="fu">map</span>(Function&lt;? <span class="kw">super</span> L, ? <span class="kw">extends</span> T&gt; lFunc,</a>
<a class="sourceLine" id="cb15-17" title="17">                             Function&lt;? <span class="kw">super</span> R, ? <span class="kw">extends</span> T&gt; rFunc) {</a>
<a class="sourceLine" id="cb15-18" title="18">                <span class="kw">return</span> rFunc.<span class="fu">apply</span>(value);</a>
<a class="sourceLine" id="cb15-19" title="19">            }</a>
<a class="sourceLine" id="cb15-20" title="20">        };</a>
<a class="sourceLine" id="cb15-21" title="21">    }</a>
<a class="sourceLine" id="cb15-22" title="22"></a>
<a class="sourceLine" id="cb15-23" title="23">    <span class="kw">private</span> <span class="fu">Either</span>() {</a>
<a class="sourceLine" id="cb15-24" title="24">    }</a>
<a class="sourceLine" id="cb15-25" title="25"></a>
<a class="sourceLine" id="cb15-26" title="26">    <span class="kw">public</span> <span class="kw">abstract</span> &lt;T&gt; T <span class="fu">map</span>(</a>
<a class="sourceLine" id="cb15-27" title="27">            Function&lt;? <span class="kw">super</span> L, ? <span class="kw">extends</span> T&gt; lFunc,</a>
<a class="sourceLine" id="cb15-28" title="28">            Function&lt;? <span class="kw">super</span> R, ? <span class="kw">extends</span> T&gt; rFunc</a>
<a class="sourceLine" id="cb15-29" title="29">    );</a>
<a class="sourceLine" id="cb15-30" title="30">}</a></code></pre></div>
</section>
<section class="slide level1">

<h2 id="drools">Drools …</h2>
<div class="sourceCode" id="cb16"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb16-1" title="1">rule <span class="st">&quot;Suggest Manager Role&quot;</span></a>
<a class="sourceLine" id="cb16-2" title="2">    when</a>
<a class="sourceLine" id="cb16-3" title="3">        <span class="fu">Applicant</span>(experienceInYears &gt; <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb16-4" title="4">        <span class="fu">Applicant</span>(currentSalary &gt; <span class="dv">1000000</span> &amp;&amp; currentSalary &lt;=</a>
<a class="sourceLine" id="cb16-5" title="5">         <span class="dv">2500000</span>)</a>
<a class="sourceLine" id="cb16-6" title="6">    then</a>
<a class="sourceLine" id="cb16-7" title="7">        suggestedRole.<span class="fu">setRole</span>(<span class="st">&quot;Manager&quot;</span>);</a>
<a class="sourceLine" id="cb16-8" title="8">end</a></code></pre></div>
</section>
<section class="slide level1">

<h2 id="drools-in-haskell">“Drools” in Haskell</h2>
<ul>
<li>just pattern matching + guards</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb17-1" title="1"><span class="kw">data</span> <span class="dt">Role</span> <span class="fu">=</span> <span class="dt">Manager</span> <span class="fu">|</span> <span class="dt">Janitor</span> <span class="fu">|</span> <span class="fu">...</span></a>
<a class="sourceLine" id="cb17-2" title="2"></a>
<a class="sourceLine" id="cb17-3" title="3"><span class="kw">data</span> <span class="dt">Applicant</span> <span class="fu">=</span> <span class="dt">Applicant</span></a>
<a class="sourceLine" id="cb17-4" title="4">    {<span class="ot"> experienceInYears ::</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb17-5" title="5">    ,<span class="ot"> currentSalary ::</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb17-6" title="6">    }</a>
<a class="sourceLine" id="cb17-7" title="7"></a>
<a class="sourceLine" id="cb17-8" title="8"><span class="ot">suggestRole ::</span> <span class="dt">Applicant</span> <span class="ot">-&gt;</span> <span class="dt">Role</span></a>
<a class="sourceLine" id="cb17-9" title="9">suggestRole (<span class="dt">Applicant</span> experienceInYears currentSalary)</a>
<a class="sourceLine" id="cb17-10" title="10">    <span class="fu">|</span> experienceInYears <span class="fu">&gt;</span> <span class="dv">10</span></a>
<a class="sourceLine" id="cb17-11" title="11">      <span class="fu">&amp;&amp;</span> currentSalary <span class="fu">&gt;</span> <span class="dv">1000000</span></a>
<a class="sourceLine" id="cb17-12" title="12">      <span class="fu">&amp;&amp;</span> currentSalary <span class="fu">&lt;=</span> <span class="dv">2500000</span> <span class="fu">=</span> <span class="dt">Manager</span></a></code></pre></div>
</section>
<section class="slide level1">

<h2 id="drools-in-haskell-1">“Drools” in Haskell</h2>
<div class="sourceCode" id="cb18"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb18-1" title="1"><span class="kw">data</span> <span class="dt">Role</span> <span class="fu">=</span> <span class="dt">Manager</span> <span class="fu">|</span> <span class="dt">Janitor</span> <span class="fu">|</span> <span class="fu">...</span></a>
<a class="sourceLine" id="cb18-2" title="2"></a>
<a class="sourceLine" id="cb18-3" title="3"><span class="kw">data</span> <span class="dt">Applicant</span> <span class="fu">=</span> <span class="dt">Applicant</span></a>
<a class="sourceLine" id="cb18-4" title="4">    {<span class="ot"> experienceInYears ::</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb18-5" title="5">    ,<span class="ot"> currentSalary ::</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb18-6" title="6">    }</a>
<a class="sourceLine" id="cb18-7" title="7"></a>
<a class="sourceLine" id="cb18-8" title="8"><span class="ot">suggestRole ::</span> <span class="dt">Applicant</span> <span class="ot">-&gt;</span> <span class="dt">Role</span></a>
<a class="sourceLine" id="cb18-9" title="9">suggestRole (<span class="dt">Applicant</span> experienceInYears currentSalary)</a>
<a class="sourceLine" id="cb18-10" title="10">    <span class="fu">|</span> experienceInYears <span class="fu">&gt;</span> <span class="dv">10</span></a>
<a class="sourceLine" id="cb18-11" title="11">      <span class="fu">&amp;&amp;</span> currentSalary <span class="fu">&gt;</span> <span class="dv">1000000</span></a>
<a class="sourceLine" id="cb18-12" title="12">      <span class="fu">&amp;&amp;</span> currentSalary <span class="fu">&lt;=</span> <span class="dv">2500000</span> <span class="fu">=</span> <span class="dt">Manager</span></a>
<a class="sourceLine" id="cb18-13" title="13">    <span class="fu">|</span> <span class="fu">otherwise</span> <span class="fu">=</span> <span class="dt">Janitor</span></a></code></pre></div>
</section>
<section class="slide level1">

<h2 id="sum-types-in-java-2">Sum types in Java</h2>
<ul>
<li>.. are hard to express</li>
<li>.. so people use products for almost everything</li>
<li>.. which leads to combinatorial explosion of invalid possibilities</li>
<li>.. so you need a lot of testing</li>
<li>.. but your code might not be easily testable</li>
</ul>
</section>
<section class="slide level1">

<h2 id="case-study">Case study</h2>
<ul>
<li>Example: <a href="https://github.com/kiegroup/kie-wb-common/blob/master/kie-wb-common-ala/kie-wb-common-ala-services-api/src/main/java/org/guvnor/ala/services/api/PipelineStageItem.java">PipelineStageItem.java</a></li>
</ul>
</section>
<section class="slide level1">

<h3 id="the-essence-of-the-solution">The essence of the solution</h3>
<div class="sourceCode" id="cb19"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb19-1" title="1"><span class="kw">data</span> <span class="dt">PipelineStageItem</span> <span class="fu">=</span></a>
<a class="sourceLine" id="cb19-2" title="2">    {<span class="ot"> name ::</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb19-3" title="3">    ,<span class="ot"> status ::</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb19-4" title="4">    ,<span class="ot"> stageError ::</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb19-5" title="5">    ,<span class="ot"> stateErrorDetail ::</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb19-6" title="6">    }</a>
<a class="sourceLine" id="cb19-7" title="7"><span class="co">-- ∞ x ∞ x ∞ x ∞</span></a></code></pre></div>
</section>
<section class="slide level1">

<h3 id="turning-comment-into-compiler-checked-documentation">.. Turning comment into compiler-checked documentation</h3>
<div class="sourceCode" id="cb20"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb20-1" title="1"><span class="kw">data</span> <span class="dt">Status</span> <span class="fu">=</span> <span class="dt">Scheduled</span> <span class="fu">|</span> <span class="dt">Running</span> <span class="fu">|</span> <span class="dt">Finished</span> <span class="fu">|</span> <span class="dt">Error</span></a>
<a class="sourceLine" id="cb20-2" title="2"><span class="co">--     4    =    1      +    1    +    1     +  1</span></a>
<a class="sourceLine" id="cb20-3" title="3"></a>
<a class="sourceLine" id="cb20-4" title="4"><span class="kw">data</span> <span class="dt">PipelineStageItem</span> <span class="fu">=</span></a>
<a class="sourceLine" id="cb20-5" title="5">    {<span class="ot"> name ::</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb20-6" title="6">    ,<span class="ot"> status ::</span> <span class="dt">Status</span></a>
<a class="sourceLine" id="cb20-7" title="7">    ,<span class="ot"> stageError ::</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb20-8" title="8">    ,<span class="ot"> stateErrorDetail ::</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb20-9" title="9">    }</a>
<a class="sourceLine" id="cb20-10" title="10"><span class="co">-- ∞ x 4 x ∞ x ∞</span></a></code></pre></div>
</section>
<section class="slide level1">

<h3 id="error-details-only-make-sense-for-error">.. error details only make sense for Error</h3>
<div class="sourceCode" id="cb21"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb21-1" title="1"><span class="kw">data</span> <span class="dt">PipelineStageItem</span> <span class="fu">=</span></a>
<a class="sourceLine" id="cb21-2" title="2">  <span class="fu">|</span> <span class="dt">Scheduled</span> {<span class="ot"> name ::</span> <span class="dt">String</span> }</a>
<a class="sourceLine" id="cb21-3" title="3">  <span class="fu">|</span> <span class="dt">Running</span>   {<span class="ot"> name ::</span> <span class="dt">String</span> }</a>
<a class="sourceLine" id="cb21-4" title="4">  <span class="fu">|</span> <span class="dt">Finished</span>  {<span class="ot"> name ::</span> <span class="dt">String</span> }</a>
<a class="sourceLine" id="cb21-5" title="5">  <span class="fu">|</span> <span class="dt">Error</span>     {<span class="ot"> name ::</span> <span class="dt">String</span>,<span class="ot"> stageError ::</span> <span class="dt">String</span> ,<span class="ot"> stateErrorDetail ::</span> <span class="dt">String</span> }</a>
<a class="sourceLine" id="cb21-6" title="6"><span class="co">-- ∞ + ∞ + ∞ + ∞ x ∞ x ∞</span></a></code></pre></div>
</section>
<section class="slide level1">

<h2 id="simplify-further">Simplify further?</h2>
<p>a + a + a + a^3<br/> = ?</p>
</section>
<section class="slide level1">

<h2 id="simplify-further-1">Simplify further</h2>
<p>a + a + a + a^3<br/> = a * (1 + 1 + 1 + a^2)</p>
</section>
<section class="slide level1">

<div class="sourceCode" id="cb22"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb22-1" title="1"><span class="kw">data</span> <span class="dt">PipelineStageItem</span> <span class="fu">=</span> <span class="dt">PipelineStageItem</span></a>
<a class="sourceLine" id="cb22-2" title="2">  {<span class="ot"> name ::</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb22-3" title="3">  ,<span class="ot"> status ::</span> <span class="dt">Status</span></a>
<a class="sourceLine" id="cb22-4" title="4">  }</a>
<a class="sourceLine" id="cb22-5" title="5"><span class="co">-- ∞ * (1 + 1 + 1 + ∞ x ∞)</span></a>
<a class="sourceLine" id="cb22-6" title="6"><span class="kw">data</span> <span class="dt">Status</span></a>
<a class="sourceLine" id="cb22-7" title="7">    <span class="fu">=</span> <span class="dt">Scheduled</span></a>
<a class="sourceLine" id="cb22-8" title="8">    <span class="fu">|</span> <span class="dt">Running</span></a>
<a class="sourceLine" id="cb22-9" title="9">    <span class="fu">|</span> <span class="dt">Finished</span></a>
<a class="sourceLine" id="cb22-10" title="10">    <span class="fu">|</span> <span class="dt">Error</span> {<span class="ot"> stageError ::</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb22-11" title="11">            ,<span class="ot"> stateErrorDetail ::</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb22-12" title="12">            }</a></code></pre></div>
</section>
<section class="slide level1">

<h2 id="tony-hoare">Tony Hoare</h2>
<p><img style="float: left;" src="image/Tony_Hoare.jpg"></p>
<ul>
<li>Inventor of
<ul>
<li>Quicksort algorithm</li>
<li>Hoare logic</li>
<li>Null references</li>
</ul></li>
</ul>
</section>
<section class="slide level1">

<p>In 2009 he said about his invention of null references:</p>
<blockquote>
<p>“I call it my billion-dollar mistake […] This has led to innumerable errors, vulnerabilities, and system crashes, which have probably caused a billion dollars of pain and damage in the last forty years.”</p>
</blockquote>
</section>
<section class="slide level1">

<h2 id="the-billion-dollar-problem">The billion dollar problem</h2>
<p>JavaScript</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb23-1" title="1"><span class="kw">data</span> <span class="fu">=</span> <span class="dt">SomeString</span></a>
<a class="sourceLine" id="cb23-2" title="2">     <span class="fu">|</span> <span class="dt">Null</span></a>
<a class="sourceLine" id="cb23-3" title="3">     <span class="fu">|</span> <span class="dt">Undefined</span></a></code></pre></div>
</section>
<section class="slide level1">

<h2 id="the-billion-dollar-problem-1">The billion dollar problem</h2>
<p>JavaScript</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb24-1" title="1"><span class="kw">data</span> <span class="dt">SomeNumber</span></a>
<a class="sourceLine" id="cb24-2" title="2">    <span class="fu">=</span> <span class="dt">Float</span></a>
<a class="sourceLine" id="cb24-3" title="3">    <span class="fu">|</span> <span class="dt">Null</span></a>
<a class="sourceLine" id="cb24-4" title="4">    <span class="fu">|</span> <span class="dt">Undefined</span></a>
<a class="sourceLine" id="cb24-5" title="5">    <span class="fu">|</span> <span class="dt">NaN</span></a>
<a class="sourceLine" id="cb24-6" title="6">    <span class="fu">|</span> <span class="dt">Infinity</span></a>
<a class="sourceLine" id="cb24-7" title="7">    <span class="fu">|</span> <span class="fu">-</span><span class="dt">Infinity</span></a></code></pre></div>
</section>
<section class="slide level1">

<h2 id="billion-dollar-solution">Billion dollar solution</h2>
<div class="sourceCode" id="cb25"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb25-1" title="1"><span class="kw">data</span> <span class="dt">User</span> <span class="fu">=</span> <span class="dt">User</span> {<span class="ot">username ::</span> <span class="dt">String</span>, <span class="fu">..</span>}</a></code></pre></div>
</section>
<section class="slide level1">

<h2 id="billion-dollar-solution-1">Billion dollar solution</h2>
<div class="sourceCode" id="cb26"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb26-1" title="1"><span class="kw">data</span> <span class="dt">User</span> <span class="fu">=</span> <span class="dt">User</span> {<span class="ot">username ::</span> <span class="dt">String</span>, <span class="fu">..</span>}</a>
<a class="sourceLine" id="cb26-2" title="2"></a>
<a class="sourceLine" id="cb26-3" title="3"><span class="kw">data</span> <span class="dt">User</span> <span class="fu">=</span> <span class="dt">User</span> {<span class="ot">username ::</span> <span class="dt">String</span>, <span class="fu">..</span>}</a>
<a class="sourceLine" id="cb26-4" title="4">          <span class="fu">|</span> <span class="dt">NotYetUser</span></a></code></pre></div>
</section>
<section class="slide level1">

<h2 id="billion-dollar-solution-2">Billion dollar solution</h2>
<ul>
<li>abstracting the pattern..</li>
</ul>
<div class="sourceCode" id="cb27"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb27-1" title="1"><span class="kw">data</span> <span class="dt">Maybe</span> a <span class="fu">=</span> <span class="dt">Just</span> a <span class="fu">|</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb27-2" title="2"><span class="co">--                a   +  1</span></a></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb28-1" title="1"><span class="kw">public</span> <span class="dt">final</span> <span class="kw">class</span> Optional&lt;T&gt; {...}</a></code></pre></div>
</section>
<section class="slide level1">

<h2 id="issues-with-optional">Issues with Optional</h2>
<div class="sourceCode" id="cb29"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb29-1" title="1">Optional.<span class="fu">of</span> <span class="co">//throws NPE</span></a>
<a class="sourceLine" id="cb29-2" title="2">Optional.<span class="fu">get</span> <span class="co">// throws NPE</span></a>
<a class="sourceLine" id="cb29-3" title="3">Optional.<span class="fu">map</span>(f.<span class="fu">compose</span>(g)) != Optional.<span class="fu">map</span>(g).<span class="fu">map</span>(f) <span class="co">// for null returning functions</span></a></code></pre></div>
</section>
<section class="slide level1">

<h2 id="spot-a-bug">Spot a bug</h2>
<p><a href="https://github.com/kiegroup/appformer/blob/0674ea8/uberfire-project/uberfire-project-backend/src/main/java/org/guvnor/common/services/project/backend/server/WorkspaceProjectServiceImpl.java#L272">WorkbenchProjectServiceImpl.java</a></p>
</section>
<section class="slide level1">

<h2 id="a-week-later">… a week later</h2>
<p><img data-src="image/Optional.get.example2.png" /></p>
</section>
<section class="slide level1">

<h3 id="meanwhile-in-appformer">… meanwhile in Appformer</h3>
<figure>
<img data-src="image/IntelliJ_Optional_get.png" alt="IntelliJ’s warnings: Optional.get without isPresent in Appformer" /><figcaption>IntelliJ’s warnings: Optional.get without isPresent in Appformer</figcaption>
</figure>
</section>
<section class="slide level1">

<h2 id="summary">Summary</h2>
<ul>
<li>Compiler can help you a lot
<ul>
<li>learn to write code to take better advantage of it!</li>
</ul></li>
<li>Algebraic data types - precisely describe data
<ul>
<li>what it IS</li>
<li>what it is NOT</li>
</ul></li>
<li>Testing can only take you so far</li>
<li>The choice of language DOES matter
<ul>
<li>people go with the “defaults” (immutability, purity)</li>
</ul></li>
<li>FP languages make it
<ul>
<li>more natural to model domains precisely</li>
<li>easier to write correct code by default</li>
</ul></li>
</ul>
</section>
<section class="slide level1">

<p>Unfortunately nobody can be <strong>told</strong> what programming in strict FP language is like..</p>
</section>
<section class="slide level1">

<p>.. you have to see it for yourself</p>
<p><img data-src="image/the-matrix-red-pill-or-blue-pill.jpg" /></p>
<ul>
<li><a href="https://www.haskell.org/">Haskell</a></li>
<li><a href="http://www.purescript.org/">Purescript</a></li>
<li><a href="https://elm-lang.org/">Elm</a></li>
</ul>
</section>
<section class="footnotes">
<hr />
<ol>
<li id="fn1"><p><a href="https://www.cs.uoregon.edu/research/summerschool/summer13/lectures/Kinds_and_GADTs.pdf">Kinds and GADTs</a><a href="#/fnref1" class="footnote-back">↩</a></p></li>
</ol>
</section>
    </div>
  </div>

  <script src="reveal.js/lib/js/head.min.js"></script>
  <script src="reveal.js/js/reveal.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Push each slide change to the browser history
        history: true,

        // Optional reveal.js plugins
        dependencies: [
          { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true },
          { src: 'reveal.js/plugin/notes/notes.js', async: true }
        ]
      });
    </script>
    </body>
</html>
