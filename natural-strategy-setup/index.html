<!DOCTYPE html>
<html lang="cs">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Robozonky :: Konfigurace Strategie</title>
  <meta name="description" content="Nástroj usnadňující tvorbu konfiguračního souboru pro Robozonky">
  <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="css/range-slider.css">
  <link rel="stylesheet" type="text/css" href="css/overrides.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
  <script src="js/elm.js"></script>
  <script>
    /* Feature detect localStorage, based on
                https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API/Using_the_Web_Storage_API#Feature-detecting_localStorage */
    function isLocalStorageSupported() {
      try {
        var storage = window['localStorage'],
          x = '__storage_test__';
        storage.setItem(x, x);
        storage.removeItem(x);
        return true;
      } catch (e) {
        return e instanceof DOMException && (
            e.code === 22 ||
            e.code === 1014 ||
            e.name === 'QuotaExceededError' ||
            e.name === 'NS_ERROR_DOM_QUOTA_REACHED') &&
          storage.length !== 0;
      }
    }

    function getFlags() {
      var strategyJson = null;
      var localStorageSupported = isLocalStorageSupported();
      if (localStorageSupported) {
        var strategyString = localStorage.getItem('persistedStrategy');
        strategyJson = strategyString ? JSON.parse(strategyString) : null;
      } else {
        console.log("Váš prohlížeč nepodporuje ukládání strategie");
      }
      return {
        "localStorageSupported": localStorageSupported,
        "persistedStrategy": strategyJson
      };
    }

    var flags = getFlags();
    var app = Elm.Main.fullscreen(flags);

    /* Port for saving strategy to localStorage */
    app.ports.persistValue.subscribe(function(strategy) {
      localStorage.setItem('persistedStrategy', JSON.stringify(strategy));
    });
  </script>
</body>

</html>
